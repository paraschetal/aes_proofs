;; This extracted scheme code relies on some additional macros
;; available at http://www.pps.univ-paris-diderot.fr/~letouzey/scheme
(load "macros_extr.scm")


(define ms_nibble (lambda (b) (match b
                                 ((Bits8 b0 b1 b2 b3 _ _ _ _) `(Bits4 ,b0 ,b1 ,b2 ,b3)))))

(define ls_nibble (lambda (b) (match b
                                 ((Bits8 _ _ _ _ b4 b5 b6 b7) `(Bits4 ,b4 ,b5 ,b6 ,b7)))))

(define xor_bits (lambdas (b1 b2) (match b1
                                     ((S0) (match b2
                                              ((S0) `(S0))
                                              ((S1) `(S1))))
                                     ((S1) (match b2
                                              ((S0) `(S1))
                                              ((S1) `(S0)))))))

(define xor_bytes (lambdas (b a)
  (match b
     ((Bits8 b7 b6 b5 b4 b3 b2 b1 b0)
       (match a
          ((Bits8 a7 a6 a5 a4 a3 a2 a1 a0) `(Bits8 ,(@ xor_bits b7 a7) ,(@ xor_bits b6 a6) ,(@ xor_bits b5 a5) ,(@ xor_bits b4 a4)
            ,(@ xor_bits b3 a3) ,(@ xor_bits b2 a2) ,(@ xor_bits b1 a1) ,(@ xor_bits b0 a0))))))))

(define s_box (lambda (b)
  (match (ms_nibble b)
     ((Bits4 b0 b1 b2 b3)
       (match b0
          ((S0)
            (match b1
               ((S0)
                 (match b2
                    ((S0)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))))))))))))))
                    ((S1)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))))))))))))))
               ((S1)
                 (match b2
                    ((S0)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))))))))))))
                    ((S1)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))))))))))))))))))
          ((S1)
            (match b1
               ((S0)
                 (match b2
                    ((S0)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))))))))))))
                    ((S1)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))))))))))))))
               ((S1)
                 (match b2
                    ((S0)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))))))))))))
                    ((S1)
                      (match b3
                         ((S0)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))))))))))
                         ((S1)
                           (match (ls_nibble b)
                              ((Bits4 b4 b5 b6 b7)
                                (match b4
                                   ((S0)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))))))))
                                   ((S1)
                                     (match b5
                                        ((S0)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S1)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S1)))))))
                                        ((S1)
                                          (match b6
                                             ((S0)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))))
                                             ((S1)
                                               (match b7
                                                  ((S0) `(Bits8 ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
                                                  ((S1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0))))))))))))))))))))))))

(define shift_rows (lambda (state)
  (match state
     ((Bytes16 r0c0 r0c1 r0c2 r0c3 r1c0 r1c1 r1c2 r1c3 r2c0 r2c1 r2c2 r2c3 r3c0 r3c1 r3c2 r3c3) `(Bytes16 ,r0c0 ,r0c1 ,r0c2 ,r0c3 ,r1c1
       ,r1c2 ,r1c3 ,r1c0 ,r2c2 ,r2c3 ,r2c0 ,r2c1 ,r3c3 ,r3c0 ,r3c1 ,r3c2)))))

(define sub_bytes (lambda (state)
  (match state
     ((Bytes16 r0c0 r0c1 r0c2 r0c3 r1c0 r1c1 r1c2 r1c3 r2c0 r2c1 r2c2 r2c3 r3c0 r3c1 r3c2 r3c3) `(Bytes16 ,(s_box r0c0) ,(s_box r0c1)
       ,(s_box r0c2) ,(s_box r0c3) ,(s_box r1c0) ,(s_box r1c1) ,(s_box r1c2) ,(s_box r1c3) ,(s_box r2c0) ,(s_box r2c1) ,(s_box r2c2)
       ,(s_box r2c3) ,(s_box r3c0) ,(s_box r3c1) ,(s_box r3c2) ,(s_box r3c3))))))

(define xtime (lambda (b)
  (match b
     ((Bits8 b7 b6 b5 b4 b3 b2 b1 b0)
       (match b7
          ((S0) `(Bits8 ,b6 ,b5 ,b4 ,b3 ,b2 ,b1 ,b0 ,`(S0)))
          ((S1)
            (@ xor_bytes `(Bits8 ,b6 ,b5 ,b4 ,b3 ,b2 ,b1 ,b0 ,`(S0)) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))))))))

(define mul02 xtime)

(define mul03 (lambda (b) (@ xor_bytes (mul02 b) b)))

(define mix_column_transform (lambda (column)
  (match column
     ((Bytes4 a b c d)
       (let ((a~ (@ xor_bytes (@ xor_bytes (@ xor_bytes (mul02 a) (mul03 b)) c) d)))
         (let ((b~ (@ xor_bytes (@ xor_bytes (@ xor_bytes a (mul02 b)) (mul03 c)) d)))
           (let ((c~ (@ xor_bytes (@ xor_bytes (@ xor_bytes a b) (mul02 c)) (mul03 d))))
             (let ((d~ (@ xor_bytes (@ xor_bytes (@ xor_bytes (mul03 a) b) c) (mul02 d)))) `(Bytes4 ,a~ ,b~ ,c~ ,d~)))))))))

(define columns_to_matrix (lambdas (c0 c1 c2 c3)
  (match c0
     ((Bytes4 c00 c10 c20 c30)
       (match c1
          ((Bytes4 c01 c11 c21 c31)
            (match c2
               ((Bytes4 c02 c12 c22 c32)
                 (match c3
                    ((Bytes4 c03 c13 c23 c33) `(Bytes16 ,c00 ,c01 ,c02 ,c03 ,c10 ,c11 ,c12 ,c13 ,c20 ,c21 ,c22 ,c23 ,c30 ,c31 ,c32
                      ,c33)))))))))))

(define mix_columns (lambda (state)
  (match state
     ((Bytes16 s00 s01 s02 s03 s10 s11 s12 s13 s20 s21 s22 s23 s30 s31 s32 s33)
       (let ((ncol0 (mix_column_transform `(Bytes4 ,s00 ,s10 ,s20 ,s30))))
         (let ((ncol1 (mix_column_transform `(Bytes4 ,s01 ,s11 ,s21 ,s31))))
           (let ((ncol2 (mix_column_transform `(Bytes4 ,s02 ,s12 ,s22 ,s32))))
             (let ((ncol3 (mix_column_transform `(Bytes4 ,s03 ,s13 ,s23 ,s33)))) (@ columns_to_matrix ncol0 ncol1 ncol2 ncol3)))))))))

(define rc (lambda (i)
  (match i
     ((R1) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1)))
     ((R2) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0)))
     ((R3) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0)))
     ((R4) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0)))
     ((R5) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
     ((R6) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
     ((R7) `(Bits8 ,`(S0) ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
     ((R8) `(Bits8 ,`(S1) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))
     ((R9) `(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1)))
     ((R10) `(Bits8 ,`(S0) ,`(S0) ,`(S1) ,`(S1) ,`(S0) ,`(S1) ,`(S1) ,`(S0))))))

(define rcon (lambda (i) `(Bytes4 ,(rc i) ,`(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)) ,`(Bits8 ,`(S0) ,`(S0)
  ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)) ,`(Bits8 ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0) ,`(S0)))))

(define xor_words (lambdas (w1 w2)
  (match w1
     ((Bytes4 b0 b1 b2 b3)
       (match w2
          ((Bytes4 a0 a1 a2 a3) `(Bytes4 ,(@ xor_bytes b0 a0) ,(@ xor_bytes b1 a1) ,(@ xor_bytes b2 a2) ,(@ xor_bytes b3 a3))))))))

(define rcon_word (lambdas (i w) (@ xor_words w (rcon i))))

(define rot_word (lambda (w) (match w
                                ((Bytes4 b0 b1 b2 b3) `(Bytes4 ,b1 ,b2 ,b3 ,b0)))))

(define sub_word (lambda (w) (match w
                                ((Bytes4 b0 b1 b2 b3) `(Bytes4 ,(s_box b0) ,(s_box b1) ,(s_box b2) ,(s_box b3))))))

(define matrix_to_keyt (lambda (k)
  (match k
     ((Bytes16 b11 b12 b13 b14 b21 b22 b23 b24 b31 b32 b33 b34 b41 b42 b43 b44) `(Keywords ,`(Bytes4 ,b11 ,b12 ,b13 ,b14) ,`(Bytes4 ,b21
       ,b22 ,b23 ,b24) ,`(Bytes4 ,b31 ,b32 ,b33 ,b34) ,`(Bytes4 ,b41 ,b42 ,b43 ,b44))))))

(define keyt_to_matrix (lambda (k)
  (match k
     ((Keywords w1 w2 w3 w4)
       (match w1
          ((Bytes4 b11 b12 b13 b14)
            (match w2
               ((Bytes4 b21 b22 b23 b24)
                 (match w3
                    ((Bytes4 b31 b32 b33 b34)
                      (match w4
                         ((Bytes4 b41 b42 b43 b44) `(Bytes16 ,b11 ,b12 ,b13 ,b14 ,b21 ,b22 ,b23 ,b24 ,b31 ,b32 ,b33 ,b34 ,b41 ,b42 ,b43
                           ,b44)))))))))))))

(define first_w_in_rk (lambdas (i w) (rot_word (sub_word (@ rcon_word i w)))))

(define rk0 (lambda (k) k))

(define rk (lambdas (i k)
  (match k
     ((Keywords w1 w2 w3 w4) `(Keywords ,(@ xor_words (@ first_w_in_rk i w4) w1)
       ,(@ xor_words (@ xor_words (@ first_w_in_rk i w4) w1) w2)
       ,(@ xor_words (@ xor_words (@ xor_words (@ first_w_in_rk i w4) w1) w2) w3)
       ,(@ xor_words (@ xor_words (@ xor_words (@ xor_words (@ first_w_in_rk i w4) w1) w2) w3) w4))))))

(define rk1 (lambda (k) (keyt_to_matrix (@ rk `(R1) (matrix_to_keyt k)))))

(define rk2 (lambda (k) (keyt_to_matrix (@ rk `(R2) (matrix_to_keyt (rk1 k))))))

(define rk3 (lambda (k) (keyt_to_matrix (@ rk `(R3) (matrix_to_keyt (rk2 k))))))

(define rk4 (lambda (k) (keyt_to_matrix (@ rk `(R4) (matrix_to_keyt (rk3 k))))))

(define rk5 (lambda (k) (keyt_to_matrix (@ rk `(R5) (matrix_to_keyt (rk4 k))))))

(define rk6 (lambda (k) (keyt_to_matrix (@ rk `(R6) (matrix_to_keyt (rk5 k))))))

(define rk7 (lambda (k) (keyt_to_matrix (@ rk `(R7) (matrix_to_keyt (rk6 k))))))

(define rk8 (lambda (k) (keyt_to_matrix (@ rk `(R8) (matrix_to_keyt (rk7 k))))))

(define rk9 (lambda (k) (keyt_to_matrix (@ rk `(R9) (matrix_to_keyt (rk8 k))))))

(define rk10 (lambda (k) (keyt_to_matrix (@ rk `(R10) (matrix_to_keyt (rk9 k))))))

(define add_round_key (lambdas (k state)
  (match k
     ((Bytes16 k00 k01 k02 k03 k10 k11 k12 k13 k20 k21 k22 k23 k30 k31 k32 k33)
       (match state
          ((Bytes16 s00 s01 s02 s03 s10 s11 s12 s13 s20 s21 s22 s23 s30 s31 s32 s33) `(Bytes16 ,(@ xor_bytes k00 s00)
            ,(@ xor_bytes k01 s01) ,(@ xor_bytes k02 s02) ,(@ xor_bytes k03 s03) ,(@ xor_bytes k10 s10) ,(@ xor_bytes k11 s11)
            ,(@ xor_bytes k12 s12) ,(@ xor_bytes k13 s13) ,(@ xor_bytes k20 s20) ,(@ xor_bytes k21 s21) ,(@ xor_bytes k22 s22)
            ,(@ xor_bytes k23 s23) ,(@ xor_bytes k30 s30) ,(@ xor_bytes k31 s31) ,(@ xor_bytes k32 s32) ,(@ xor_bytes k33 s33))))))))

(define xor_matrices add_round_key)

(define key0 rk0)

(define key1 rk1)

(define key2 rk2)

(define key3 rk3)

(define key4 rk4)

(define key5 rk5)

(define key6 rk6)

(define key7 rk7)

(define key8 rk8)

(define key9 rk9)

(define key10 rk10)

(define enc_round1 (lambdas (k s) (@ add_round_key (key1 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round2 (lambdas (k s) (@ add_round_key (key2 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round3 (lambdas (k s) (@ add_round_key (key3 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round4 (lambdas (k s) (@ add_round_key (key4 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round5 (lambdas (k s) (@ add_round_key (key5 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round6 (lambdas (k s) (@ add_round_key (key6 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round7 (lambdas (k s) (@ add_round_key (key7 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round8 (lambdas (k s) (@ add_round_key (key8 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round9 (lambdas (k s) (@ add_round_key (key9 k) (mix_columns (shift_rows (sub_bytes s))))))

(define enc_round10 (lambdas (k s) (@ add_round_key (key10 k) (shift_rows (sub_bytes s)))))

(define enc_aes (lambdas (k m)
  (@ enc_round10 k
    (@ enc_round9 k
      (@ enc_round8 k
        (@ enc_round7 k
          (@ enc_round6 k
            (@ enc_round5 k (@ enc_round4 k (@ enc_round3 k (@ enc_round2 k (@ enc_round1 k (@ add_round_key (key0 k) m)))))))))))))

(define enc_aes_cbc (lambdas (key iv message)
  (match message
     ((B0 s) `(B0 ,(@ enc_aes key (@ xor_matrices iv s))))
     ((BS s b) (let ((niv (@ enc_aes key (@ xor_matrices iv s)))) `(BS ,niv ,(@ enc_aes_cbc key niv b)))))))
  
